# 微信通知配置说明

本脚本支持两种微信通知方式：
1. **Server酱 Turbo**（推荐，最简单）
2. **企业微信**（更稳定，需要企业账号）

---

## 方案一：Server酱 Turbo（推荐）

### 1. 微信端配置（5分钟）

1. **访问 Server酱 官网**
   - 打开：https://sct.ftqq.com/
   - 使用微信扫码登录

2. **获取 SendKey**
   - 登录后，在首页可以看到你的 `SendKey`
   - 复制这个 SendKey（格式类似：`SCT1234567890abcdef`）

3. **测试通知**
   - 在页面上点击"发送测试消息"
   - 确认微信能收到消息

### 2. Linux 服务器配置

#### 方式 A：使用环境变量（推荐）

```bash
# 编辑 ~/.bashrc 或 ~/.zshrc
export SENDKEY="你的SendKey"

# 重新加载配置
source ~/.bashrc
```

#### 方式 B：直接在命令中指定

```bash
python /root/0/T3Time/notify_wechat.py \
  --method serverchan \
  --sendkey "你的SendKey" \
  --title "测试通知" \
  --body "这是一条测试消息"
```

### 3. 测试

```bash
python /root/0/T3Time/notify_wechat.py \
  --method serverchan \
  --sendkey "你的SendKey" \
  --title "T3Time 测试" \
  --body "如果你收到这条消息，说明配置成功！"
```

---

## 方案二：企业微信（更稳定）

### 1. 微信端配置（10分钟）

#### 步骤 1：注册企业微信
1. 访问：https://work.weixin.qq.com/
2. 点击"企业注册"，使用微信扫码注册
3. 填写企业信息（可以随便填，比如"我的个人通知"）
4. 完成注册

#### 步骤 2：创建应用
1. 登录企业微信管理后台
2. 进入 **应用管理** → **应用** → **自建**
3. 点击 **创建应用**
4. 填写应用信息：
   - 应用名称：`T3Time通知`（随便起）
   - 应用logo：可选
   - 可见范围：选择"企业内所有成员"
5. 创建完成后，记录以下信息：
   - **AgentId**（应用ID）
   - **Secret**（应用密钥，点击"查看"后显示）

#### 步骤 3：获取企业ID
1. 在企业微信管理后台，进入 **我的企业**
2. 找到 **企业ID**（CorpID），复制保存

#### 步骤 4：关注企业微信
1. 在企业微信管理后台，进入 **我的企业** → **微信插件**
2. 用微信扫描"企业微信插件二维码"
3. 关注后，你的微信就能收到企业微信的消息了

### 2. Linux 服务器配置

#### 方式 A：使用环境变量（推荐）

```bash
# 编辑 ~/.bashrc 或 ~/.zshrc
export QYWX_CORPID="你的企业ID"
export QYWX_CORPSECRET="你的应用Secret"
export QYWX_AGENTID="你的应用AgentID"

# 重新加载配置
source ~/.bashrc
```

#### 方式 B：直接在命令中指定

```bash
python /root/0/T3Time/notify_wechat.py \
  --method qywx \
  --corpid "你的企业ID" \
  --corpsecret "你的应用Secret" \
  --agentid "你的应用AgentID" \
  --title "测试通知" \
  --body "这是一条测试消息"
```

### 3. 测试

```bash
python /root/0/T3Time/notify_wechat.py \
  --method qywx \
  --corpid "你的企业ID" \
  --corpsecret "你的应用Secret" \
  --agentid "你的应用AgentID" \
  --title "T3Time 测试" \
  --body "如果你收到这条消息，说明配置成功！"
```

---

## 在实验脚本中使用

### 1. 在 Bash 脚本中使用（如八卡寻优脚本）

在脚本最后添加：

```bash
# 发送完成通知
python /root/0/T3Time/notify_wechat.py \
  --method serverchan \
  --title "ETTh2 八卡寻优完成" \
  --body "GPU${GPU_ID} 所有实验完成
日志目录: ${LOG_DIR}
完成时间: $(date '+%Y-%m-%d %H:%M:%S')" || true
```

如果使用环境变量，可以简化为：

```bash
python /root/0/T3Time/notify_wechat.py \
  --title "ETTh2 八卡寻优完成" \
  --body "GPU${GPU_ID} 所有实验完成，日志: ${LOG_DIR}" || true
```

### 2. 在 Python 训练脚本中使用

```python
import subprocess
import sys
from datetime import datetime

def notify(title, body):
    """发送微信通知"""
    try:
        subprocess.run(
            [
                sys.executable,
                "/root/0/T3Time/notify_wechat.py",
                "--title", title,
                "--body", body,
            ],
            check=False,
        )
    except Exception as e:
        print(f"发送通知失败: {e}")

# 在训练结束后调用
notify(
    "T3Time 训练完成",
    f"训练脚本已完成\n完成时间: {datetime.now()}"
)
```

---

## 推荐配置

**推荐使用 Server酱 Turbo**，因为：
- ✅ 配置最简单（只需要一个 SendKey）
- ✅ 不需要企业认证
- ✅ 免费版足够个人使用
- ✅ 支持 Markdown 格式

**如果 Server酱 不稳定，再考虑企业微信**。

---

## 常见问题

### Q: Server酱 免费版有限制吗？
A: 免费版每天有推送次数限制（通常足够用），如果需要更多可以升级。

### Q: 企业微信需要企业认证吗？
A: 不需要，个人可以注册"企业"账号，只是功能有限制，但通知功能完全够用。

### Q: 两种方式可以同时使用吗？
A: 可以，脚本支持两种方式，你可以配置两个不同的通知脚本。

### Q: 如何查看通知历史？
A: Server酱 可以在官网查看推送记录；企业微信可以在企业微信客户端查看。
